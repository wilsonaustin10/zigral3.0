<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple noVNC Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #vnc-container { width: 100%; height: 90vh; background: #1E1E1E; }
        #status { padding: 10px; background: #f5f5f5; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div id="status">Loading noVNC...</div>
    <div id="vnc-container"></div>

    <!-- Load noVNC from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@novnc/novnc@1.4.0/dist/novnc.min.js"></script>
    
    <script>
        const vncContainer = document.getElementById('vnc-container');
        const statusElement = document.getElementById('status');
        
        // Connection settings
        const host = window.location.hostname || 'localhost';
        const port = '6080';
        const password = 'zigral';
        const path = '/websockify';
        const wsUrl = `ws://${host}:${port}${path}`;
        
        function updateStatus(message, isError = false) {
            statusElement.textContent = message;
            statusElement.className = isError ? 'error' : '';
        }
        
        // Initialize connection
        window.addEventListener('load', function() {
            updateStatus('Connecting to VNC server...');
            
            try {
                // Check if RFB is available
                if (typeof RFB === 'undefined') {
                    updateStatus('Error: RFB not found. noVNC library not loaded correctly.', true);
                    return;
                }
                
                // Create RFB connection
                const rfb = new RFB(vncContainer, wsUrl, { 
                    credentials: { password },
                    shared: true,
                    showDotCursor: true,
                    scaleViewport: true
                });
                
                // Event handlers
                rfb.addEventListener('connect', () => {
                    updateStatus('Connected to VNC server');
                    
                    // Make connection available to agent
                    window.zigralVNC = {
                        rfb,
                        sendKey: (keysym, code, down) => rfb.sendKey(keysym, code, down),
                        sendPointer: (x, y, mask) => rfb.sendPointer(x, y, mask),
                        focus: () => rfb.focus()
                    };
                });
                
                rfb.addEventListener('disconnect', (e) => {
                    updateStatus(`Disconnected: ${e.detail.reason}`, true);
                    window.zigralVNC = null;
                });
                
                rfb.addEventListener('credentialsrequired', () => {
                    rfb.sendCredentials({ password });
                });
                
            } catch (err) {
                updateStatus(`Error initializing VNC: ${err.message}`, true);
                console.error('VNC initialization error:', err);
            }
        });
    </script>
</body>
</html> 